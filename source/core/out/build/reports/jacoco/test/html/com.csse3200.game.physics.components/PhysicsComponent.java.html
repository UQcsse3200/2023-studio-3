<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PhysicsComponent.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">core</a> &gt; <a href="index.source.html" class="el_package">com.csse3200.game.physics.components</a> &gt; <span class="el_source">PhysicsComponent.java</span></div><h1>PhysicsComponent.java</h1><pre class="source lang-java linenums">package com.csse3200.game.physics.components;

import com.badlogic.gdx.math.Vector2;
import com.badlogic.gdx.physics.box2d.Body;
import com.badlogic.gdx.physics.box2d.BodyDef;
import com.badlogic.gdx.physics.box2d.BodyDef.BodyType;
import com.csse3200.game.components.Component;
import com.csse3200.game.physics.BodyUserData;
import com.csse3200.game.physics.PhysicsContactListener;
import com.csse3200.game.physics.PhysicsEngine;
import com.csse3200.game.services.ServiceLocator;

/**
 * Lets an entity be controlled by physics. Do not directly modify the position of a physics-enabled
 * entity. Instead, use forces to move it.
 *
 * &lt;p&gt;Entities with a PhysicsComponent will fire &quot;collisionStart&quot; and &quot;collisionEnd&quot; events. See
 * {@link PhysicsContactListener }
 */
public class PhysicsComponent extends Component {
  private static final float GROUND_FRICTION = 5f;
  private final PhysicsEngine physics;
  private final Body body;

  /** Create a physics component with default settings. */
  public PhysicsComponent() {
<span class="fc" id="L27">    this(ServiceLocator.getPhysicsService().getPhysics());</span>
<span class="fc" id="L28">  }</span>

  /**
   * Create a physics component
   *
   * @param engine The physics engine to attach the component to
   */
<span class="fc" id="L35">  public PhysicsComponent(PhysicsEngine engine) {</span>
<span class="fc" id="L36">    this.physics = engine;</span>

<span class="fc" id="L38">    BodyDef bodyDef = new BodyDef();</span>
<span class="fc" id="L39">    bodyDef.type = BodyType.DynamicBody;</span>
<span class="fc" id="L40">    bodyDef.fixedRotation = true;</span>
<span class="fc" id="L41">    bodyDef.linearDamping = GROUND_FRICTION;</span>
<span class="fc" id="L42">    bodyDef.angle = 0f;</span>
<span class="fc" id="L43">    bodyDef.active = false;</span>
<span class="fc" id="L44">    body = physics.createBody(bodyDef);</span>
<span class="fc" id="L45">  }</span>

  /**
   * Set body type
   *
   * @param bodyType body type, default = dynamic
   * @return self
   */
  public PhysicsComponent setBodyType(BodyType bodyType) {
<span class="fc" id="L54">    body.setType(bodyType);</span>
<span class="fc" id="L55">    return this;</span>
  }

  /**
   * Get the physics body.
   *
   * @return physics body if entity has been created, null otherwise.
   */
  public Body getBody() {
<span class="fc" id="L64">    return body;</span>
  }

  @Override
  public void create() {
<span class="fc" id="L69">    body.setTransform(entity.getPosition(), 0f);</span>
<span class="fc" id="L70">    body.setActive(true);</span>

<span class="fc" id="L72">    BodyUserData userData = new BodyUserData();</span>
<span class="fc" id="L73">    userData.entity = entity;</span>
<span class="fc" id="L74">    body.setUserData(userData);</span>

<span class="fc" id="L76">    entity.getEvents().addListener(&quot;setPosition&quot;, (Vector2 pos) -&gt; body.setTransform(pos, 0f));</span>
<span class="fc" id="L77">  }</span>

  /**
   * Entity position needs to be updated to match the new physics position. This should happen
   * before other updates, which may use the new position.
   */
  @Override
  public void earlyUpdate() {
<span class="fc" id="L85">    Vector2 bodyPos = body.getPosition();</span>
    // Don't notify position changes due to physics
<span class="fc" id="L87">    entity.setPosition(bodyPos, false);</span>
<span class="fc" id="L88">  }</span>

  @Override
  public void dispose() {
<span class="fc" id="L92">    physics.destroyBody(body);</span>
<span class="fc" id="L93">  }</span>

  @Override
  public void setEnabled(boolean enabled) {
<span class="nc" id="L97">    super.setEnabled(enabled);</span>
<span class="nc" id="L98">    body.setActive(enabled);</span>
<span class="nc" id="L99">  }</span>

<span class="fc" id="L101">  public enum AlignX {</span>
<span class="fc" id="L102">    LEFT,</span>
<span class="fc" id="L103">    CENTER,</span>
<span class="fc" id="L104">    RIGHT</span>
  }

<span class="fc" id="L107">  public enum AlignY {</span>
<span class="fc" id="L108">    BOTTOM,</span>
<span class="fc" id="L109">    CENTER,</span>
<span class="fc" id="L110">    TOP</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>