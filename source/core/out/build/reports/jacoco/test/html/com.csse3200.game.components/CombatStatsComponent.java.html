<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CombatStatsComponent.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">core</a> &gt; <a href="index.source.html" class="el_package">com.csse3200.game.components</a> &gt; <span class="el_source">CombatStatsComponent.java</span></div><h1>CombatStatsComponent.java</h1><pre class="source lang-java linenums">package com.csse3200.game.components;

import com.csse3200.game.entities.Entity;
import com.csse3200.game.entities.Melee;
import com.csse3200.game.entities.Weapon;
import com.csse3200.game.entities.configs.ProjectileConfig;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import java.security.SecureRandom;
import java.util.ArrayList;
import java.util.Currency;

/**
 * Component used to store information related to combat such as health, attack, etc. Any entities
 * which engage it combat should have an instance of this class registered. This class can be
 * extended for more specific combat needs.
 *
 * health: the current health of the entity
 * baseAttack: the base attack of the entity
 * fullHealth: the full health of the entity
 * state: the current state of the entity (full health above 66%, half health above 33%, low health below 33%)
 * drops: the items that the entity drops when it dies
 * closeRangeAbilities: the Melee abilities (close range) of the entity
 * longRangeAbilities: the Projectile abilities (long range) of the entity
 *
 */
public class CombatStatsComponent extends Component {

<span class="fc" id="L29">  private static final Logger logger = LoggerFactory.getLogger(CombatStatsComponent.class);</span>
  private static final String HEALTH_FULL = &quot;fullHealth&quot;;
  private static final String HEALTH_MID = &quot;midHealth&quot;;
  private static final String HEALTH_LOW = &quot;lowHealth&quot;;
  private static final String HIT_EVENT = &quot;hitStart&quot;;
  private static final String UPDATE_HEALTH_EVENT = &quot;updateHealth&quot;;
  private int health;
  private int baseAttack;
  private int fullHealth;
  private String state;
  private ArrayList&lt;Currency&gt; drops;
  private ArrayList&lt;Melee&gt; closeRangeAbilities;
  private ArrayList&lt;ProjectileConfig&gt; longRangeAbilities; //TODO change String to Projectiles
<span class="fc" id="L42">  private SecureRandom rand = new SecureRandom();</span>

<span class="fc" id="L44">  public CombatStatsComponent(int health, int baseAttack) {</span>
<span class="fc" id="L45">    setHealth(health);</span>
<span class="fc" id="L46">    setBaseAttack(baseAttack);</span>
<span class="fc" id="L47">    this.fullHealth = health;</span>
<span class="fc" id="L48">    this.state = HEALTH_FULL;</span>
<span class="fc" id="L49">  }</span>

  public CombatStatsComponent(int health, int baseAttack,
                              ArrayList&lt;Currency&gt; drops,
                              ArrayList&lt;Melee&gt; closeRangeAbilities,
<span class="fc" id="L54">                              ArrayList&lt;ProjectileConfig&gt; longRangeAbilities) {</span>
<span class="fc" id="L55">    setHealth(health);</span>
<span class="fc" id="L56">    this.fullHealth = health;</span>
<span class="fc" id="L57">    setBaseAttack(baseAttack);</span>
<span class="fc" id="L58">    this.drops = drops;</span>
<span class="fc" id="L59">    this.closeRangeAbilities = closeRangeAbilities;</span>
<span class="fc" id="L60">    this.longRangeAbilities = longRangeAbilities;</span>
<span class="fc" id="L61">    this.state = HEALTH_FULL;</span>
<span class="fc" id="L62">  }</span>

  /**
   * Returns true if the entity's has 0 health, otherwise false.
   *
   * @return is player dead
   */
  public Boolean isDead() {
<span class="fc bfc" id="L70" title="All 2 branches covered.">    return health == 0;</span>
  }

  /**
   * Returns the entity's health.
   *
   * @return entity's health
   */
  public int getHealth() {
<span class="fc" id="L79">    return health;</span>
  }

  /**
   * Sets the entity's health. Health has a minimum bound of 0.
   *
   * @param health health
   */
  public void setHealth(int health) {
<span class="fc bfc" id="L88" title="All 2 branches covered.">    if (health &gt;= 0) {</span>
<span class="fc" id="L89">      this.health = health;</span>
    } else {
<span class="fc" id="L91">      this.health = 0;</span>
    }

<span class="fc bfc" id="L94" title="All 2 branches covered.">    if (entity != null) {</span>
<span class="fc" id="L95">      entity.getEvents().trigger(UPDATE_HEALTH_EVENT, this.health);</span>
    }
<span class="fc" id="L97">  }</span>

  /**
   * Adds to the player's health. The amount added can be negative.
   *
   * @param health health to add
   */
  public void addHealth(int health) {
<span class="fc" id="L105">      setHealth(this.health + health);</span>
<span class="fc" id="L106">      changeState();</span>
<span class="fc" id="L107">  }</span>

  /**
   * Returns the entity's fullHealth value (note that this does not influence the ability to set its actual health)
   *
   * @return The entity's fullHealth variable
   */
  public int getMaxHealth() {
<span class="fc" id="L115">      return fullHealth;</span>
  }

  /**
   * Sets the entity's fullHealth variable.
   * Intended for when the entity's maximum health must be changed after creation, like upgrading a turret's HP.
   *
   * @param newMaxHealth The new value fullHealth should be set to
   */
  public void setMaxHealth(int newMaxHealth) {
<span class="fc" id="L125">      fullHealth = newMaxHealth;</span>
<span class="fc" id="L126">  }</span>

  /**
   * Returns the entity's base attack damage.
   *
   * @return base attack damage
   */
  public int getBaseAttack() {
<span class="fc" id="L134">    return baseAttack;</span>
  }

  /**
   * Sets the entity's attack damage. Attack damage has a minimum bound of 0.
   *
   * @param attack Attack damage
   */
  public void setBaseAttack(int attack) {
<span class="fc bfc" id="L143" title="All 2 branches covered.">    if (attack &gt;= 0) {</span>
<span class="fc" id="L144">      this.baseAttack = attack;</span>
    } else {
<span class="fc" id="L146">      logger.error(&quot;Can not set base attack to a negative attack value&quot;);</span>
    }
<span class="fc" id="L148">  }</span>

  /**
   * Decrease the health of the entity based on the damage provided.
   * */
  public void hit(Integer damage) {
<span class="fc" id="L154">    int newHealth = getHealth() - damage;</span>
<span class="fc" id="L155">    setHealth(newHealth);</span>
<span class="fc bfc" id="L156" title="All 4 branches covered.">    if (entity != null &amp;&amp; !this.isDead()) {</span>
<span class="fc" id="L157">        entity.getEvents().trigger(HIT_EVENT);</span>
    }
<span class="fc" id="L159">    changeState();</span>
<span class="fc" id="L160">  }</span>

  // Default CombatStatsComponent that relies on the attacker's combatStatsComponent.
  public void hit(CombatStatsComponent attacker) {
<span class="fc" id="L164">    int newHealth = getHealth() - attacker.getBaseAttack();</span>
<span class="pc bpc" id="L165" title="2 of 4 branches missed.">    if (entity != null &amp;&amp; !this.isDead()) {</span>
<span class="fc" id="L166">        entity.getEvents().trigger(HIT_EVENT);</span>
    }
<span class="fc" id="L168">    setHealth(newHealth);</span>
<span class="fc" id="L169">    changeState();</span>
<span class="fc" id="L170">  }</span>

  /**
   * Picks a random number from range 0 to the size of the list provided.
   */
  public int pickRandom(ArrayList pickFrom) {
<span class="fc" id="L176">      return rand.nextInt(pickFrom.size());</span>
  }

  //TODO: this will be changed to drop an item and load it to the screen
  public Currency drop() {
<span class="nc" id="L181">      return this.drops.get(pickRandom(this.drops));</span>
  }

  /**
   * If there are long range attacks provided, return a random one, else
   * return null
   * */
    public ProjectileConfig longRangeAttack() {
<span class="pc bpc" id="L189" title="1 of 2 branches missed.">      if (this.longRangeAbilities == null) {</span>
<span class="fc" id="L190">          return null;</span>
      }
<span class="nc" id="L192">        return this.longRangeAbilities.get(pickRandom(this.longRangeAbilities));</span>
    }

    /**
     * Check if the target is within range of any of the close range attacks.
     * Return a list of close range attacks which can be used
     * */
    public ArrayList&lt;Melee&gt; withinRange(Entity target) {
<span class="fc" id="L200">        float distance = this.entity.getPosition().dst(target.getPosition());</span>
<span class="fc" id="L201">        ArrayList&lt;Melee&gt; withinRange = new ArrayList&lt;&gt;();</span>

<span class="pc bpc" id="L203" title="1 of 2 branches missed.">        if (this.closeRangeAbilities == null) {</span>
<span class="fc" id="L204">            return withinRange;</span>
        }
<span class="nc bnc" id="L206" title="All 2 branches missed.">        for (Melee melee : this.closeRangeAbilities) {</span>
<span class="nc bnc" id="L207" title="All 2 branches missed.">            if (distance &lt;= melee.getAttackRange()) {</span>
<span class="nc" id="L208">                withinRange.add(melee);</span>
            }
<span class="nc" id="L210">        }</span>
<span class="nc" id="L211">        return withinRange;</span>
    }

    /**
     * Return a close range attack if the target is within range, else
     * return a long range attack
     * */
    public Weapon getWeapon(Entity target) {
<span class="fc" id="L219">      ArrayList&lt;Melee&gt; withinRange = withinRange(target);</span>
<span class="pc bpc" id="L220" title="1 of 2 branches missed.">      if (withinRange.size() &gt; 0) {</span>
<span class="nc" id="L221">          return withinRange.get(pickRandom(withinRange));</span>
      }

<span class="fc" id="L224">      return longRangeAttack();</span>
    }

    /**
     * Change the state of the enemy based on the health
     * */
    public void changeState() {
<span class="fc bfc" id="L231" title="All 2 branches covered.">        if (this.health &lt;= (this.fullHealth * 0.33)) {</span>
<span class="fc" id="L232">            this.state = HEALTH_LOW;</span>
<span class="fc bfc" id="L233" title="All 2 branches covered.">        } else if (this.health &lt;= (this.fullHealth * 0.66)) {</span>
<span class="fc" id="L234">            this.state = HEALTH_MID;</span>
        } else {
<span class="fc" id="L236">            this.state = HEALTH_FULL;</span>
        }
<span class="fc" id="L238">    }</span>

    /**
     * Return the state of the enemy
     * fullHealth: above 66% of full health
     * midHealth: above 33% of full health
     * lowHealth: below 33% of full health
     * */
    public String getState() {
<span class="fc" id="L247">        return this.state;</span>
    }

    /**
     * Update the health of the enemy.
     * Used in WaveFactory to increase difficulty of enemies
     * */
    public void updateHealth(int setTo) {
<span class="nc" id="L255">      this.health = setTo;</span>
<span class="nc" id="L256">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>