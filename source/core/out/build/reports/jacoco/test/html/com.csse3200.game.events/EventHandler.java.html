<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>EventHandler.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">core</a> &gt; <a href="index.source.html" class="el_package">com.csse3200.game.events</a> &gt; <span class="el_source">EventHandler.java</span></div><h1>EventHandler.java</h1><pre class="source lang-java linenums">package com.csse3200.game.events;

import com.badlogic.gdx.utils.Array;
import com.csse3200.game.events.listeners.*;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.util.HashMap;
import java.util.Map;
import java.util.function.Consumer;

/**
 * Send and receive events between objects. EventHandler provides an implementation of the Observer
 * pattern, also known as an event system or publish/subscribe. When an event is triggered with
 * trigger(), all listeners are notified of the event.
 *
 * &lt;p&gt;Currently supports up to 3 arguments for an event. More can be added, but consider instead
 * passing a class with required fields.
 *
 * &lt;p&gt;If you get a ClassCastException from an event, trigger is being called with different
 * arguments than the listeners expect.
 */
public class EventHandler {
<span class="fc" id="L24">  private static final Logger logger = LoggerFactory.getLogger(EventHandler.class);</span>
  Map&lt;String, Array&lt;EventListener&gt;&gt; listeners;

<span class="fc" id="L27">  public EventHandler() {</span>
    // Assume no events by default, which will be the case for most entities
<span class="fc" id="L29">    listeners = new HashMap&lt;&gt;(0);</span>
<span class="fc" id="L30">  }</span>

  /**
   * Add a listener to an event with zero arguments
   *
   * @param eventName name of the event
   * @param listener function to call when event fires
   */
  public void addListener(String eventName, EventListener0 listener) {
<span class="fc" id="L39">    registerListener(eventName, listener);</span>
<span class="fc" id="L40">  }</span>

  /**
   * Add a listener to an event with one argument
   *
   * @param eventName name of the event
   * @param listener function to call when event fires
   * @param &lt;T&gt; argument type
   */
  public &lt;T&gt; void addListener(String eventName, EventListener1&lt;T&gt; listener) {
<span class="fc" id="L50">    registerListener(eventName, listener);</span>
<span class="fc" id="L51">  }</span>

  /**
   * Add a listener to an event with two arguments
   *
   * @param eventName name of the event
   * @param listener function to call when event fires
   * @param &lt;T0&gt; Type of arg 0
   * @param &lt;T1&gt; Type of arg 1
   */
  public &lt;T0, T1&gt; void addListener(String eventName, EventListener2&lt;T0, T1&gt; listener) {
<span class="fc" id="L62">    registerListener(eventName, listener);</span>
<span class="fc" id="L63">  }</span>

  /**
   * Add a listener to an event with three arguments
   *
   * @param eventName name of the event
   * @param listener function to call when event fires
   * @param &lt;T0&gt; Type of arg 0
   * @param &lt;T1&gt; Type of arg 1
   * @param &lt;T2&gt; Type of arg 2
   */
  public &lt;T0, T1, T2&gt; void addListener(String eventName, EventListener3&lt;T0, T1, T2&gt; listener) {
<span class="fc" id="L75">    registerListener(eventName, listener);</span>
<span class="fc" id="L76">  }</span>

  /**
   * Trigger an event with no arguments
   *
   * @param eventName name of the event
   */
  public void trigger(String eventName) {
<span class="fc" id="L84">    logTrigger(eventName);</span>
<span class="fc" id="L85">    forEachListener(eventName, (EventListener listener) -&gt; ((EventListener0) listener).handle());</span>
<span class="fc" id="L86">  }</span>

  /**
   * Trigger an event with one argument
   *
   * @param eventName name of the event
   * @param arg0 arg to pass to event
   * @param &lt;T&gt; argument type
   */
  @SuppressWarnings(&quot;unchecked&quot;)
  public &lt;T&gt; void trigger(String eventName, T arg0) {
<span class="fc" id="L97">    logTrigger(eventName);</span>
<span class="fc" id="L98">    forEachListener(</span>
<span class="fc" id="L99">        eventName, (EventListener listener) -&gt; ((EventListener1&lt;T&gt;) listener).handle(arg0));</span>
<span class="fc" id="L100">  }</span>

  /**
   * Trigger an event with one argument
   *
   * @param eventName name of the event
   * @param arg0 arg 0 to pass to event
   * @param arg1 arg 1 to pass to event
   * @param &lt;T0&gt; Type of arg 0
   * @param &lt;T1&gt; Type of arg 1
   */
  @SuppressWarnings(&quot;unchecked&quot;)
  public &lt;T0, T1&gt; void trigger(String eventName, T0 arg0, T1 arg1) {
<span class="fc" id="L113">    logTrigger(eventName);</span>
<span class="fc" id="L114">    forEachListener(</span>
        eventName,
<span class="fc" id="L116">        (EventListener listener) -&gt; ((EventListener2&lt;T0, T1&gt;) listener).handle(arg0, arg1));</span>
<span class="fc" id="L117">  }</span>

  /**
   * Trigger an event with one argument
   *
   * @param eventName name of the event
   * @param arg0 arg 0 to pass to event
   * @param arg1 arg 1 to pass to event
   * @param arg2 arg 2 to pass to event
   * @param &lt;T0&gt; Type of arg 0
   * @param &lt;T1&gt; Type of arg 1
   * @param &lt;T2&gt; Type of arg 2
   */
  @SuppressWarnings(&quot;unchecked&quot;)
  public &lt;T0, T1, T2&gt; void trigger(String eventName, T0 arg0, T1 arg1, T2 arg2) {
<span class="fc" id="L132">    logTrigger(eventName);</span>
<span class="fc" id="L133">    forEachListener(</span>
        eventName,
        (EventListener listener) -&gt;
<span class="fc" id="L136">            ((EventListener3&lt;T0, T1, T2&gt;) listener).handle(arg0, arg1, arg2));</span>
<span class="fc" id="L137">  }</span>

  private void registerListener(String eventName, EventListener listener) {
<span class="fc" id="L140">    logger.debug(&quot;Adding listener {} to event {}&quot;, listener, eventName);</span>
<span class="fc" id="L141">    Array&lt;EventListener&gt; eventListeners = listeners.getOrDefault(eventName, null);</span>
<span class="fc bfc" id="L142" title="All 2 branches covered.">    if (eventListeners == null) {</span>
<span class="fc" id="L143">      eventListeners = new Array&lt;&gt;(1);</span>
<span class="fc" id="L144">      listeners.put(eventName, eventListeners);</span>
    }
<span class="fc" id="L146">    eventListeners.add(listener);</span>
<span class="fc" id="L147">  }</span>

  private void forEachListener(String eventName, Consumer&lt;EventListener&gt; func) {
<span class="fc" id="L150">    Array&lt;EventListener&gt; eventListeners = listeners.getOrDefault(eventName, null);</span>
<span class="fc bfc" id="L151" title="All 2 branches covered.">    if (eventListeners != null) {</span>
<span class="fc" id="L152">      eventListeners.forEach(func);</span>
    }
<span class="fc" id="L154">  }</span>

  private static void logTrigger(String eventName) {
<span class="fc" id="L157">    logger.debug(&quot;Triggering event {}&quot;, eventName);</span>
<span class="fc" id="L158">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>