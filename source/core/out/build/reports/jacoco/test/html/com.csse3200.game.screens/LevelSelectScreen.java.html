<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>LevelSelectScreen.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">core</a> &gt; <a href="index.source.html" class="el_package">com.csse3200.game.screens</a> &gt; <span class="el_source">LevelSelectScreen.java</span></div><h1>LevelSelectScreen.java</h1><pre class="source lang-java linenums">package com.csse3200.game.screens;

import com.badlogic.gdx.Gdx;
import com.badlogic.gdx.ScreenAdapter;
import com.badlogic.gdx.audio.Music;
import com.badlogic.gdx.graphics.GL20;
import com.badlogic.gdx.graphics.Texture;
import com.badlogic.gdx.graphics.g2d.BitmapFont;
import com.badlogic.gdx.graphics.g2d.Sprite;
import com.badlogic.gdx.graphics.g2d.SpriteBatch;
import com.badlogic.gdx.math.Rectangle;
import com.badlogic.gdx.math.Vector3;
import com.badlogic.gdx.scenes.scene2d.Stage;
import com.badlogic.gdx.scenes.scene2d.ui.Skin;
import com.badlogic.gdx.scenes.scene2d.ui.Table;
import com.badlogic.gdx.scenes.scene2d.ui.TextButton;
import com.badlogic.gdx.scenes.scene2d.utils.ClickListener;
import com.badlogic.gdx.utils.TimeUtils;
import com.badlogic.gdx.utils.viewport.FitViewport;
import com.csse3200.game.GdxGame;
import com.csse3200.game.components.mainmenu.MainMenuDisplay;
import com.csse3200.game.entities.factories.RenderFactory;
import com.csse3200.game.rendering.Renderer;
import com.csse3200.game.screens.text.AnimatedText;
import com.csse3200.game.screens.Planets;
import com.csse3200.game.services.GameEndService;
import com.csse3200.game.services.ResourceService;
import com.csse3200.game.services.ServiceLocator;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.w3c.dom.Text;

import static com.badlogic.gdx.scenes.scene2d.ui.Table.Debug.table;

/**
 * The game screen where you can choose a planet to play on.
 */
public class LevelSelectScreen extends ScreenAdapter {
<span class="nc" id="L39">    Logger logger = LoggerFactory.getLogger(LevelSelectScreen.class);</span>
    private final GdxGame game;
    private SpriteBatch batch;
<span class="nc" id="L42">    private int selectedLevel = -1;</span>

    private static final String INTRO_TEXT = &quot;Select a Planet for Conquest&quot;;
    private Stage stage;
    private AnimatedText text;
    private BitmapFont font;

    private Sprite background;
<span class="nc" id="L50">    private String[] bgm = {</span>
            &quot;sounds/background/pre_game/Sci-Fi8Loop_story.ogg&quot;
    };
    private Music music;

    // Stores a time to determine the frame of the planet
    // TODO: Account for integer overflow
<span class="nc" id="L57">    float timeCounter = 0;</span>

    private static final String BG_PATH = &quot;planets/background.png&quot;;

<span class="nc" id="L61">    public LevelSelectScreen(GdxGame game) {</span>
<span class="nc" id="L62">        font = new BitmapFont();</span>
<span class="nc" id="L63">        text = new AnimatedText(INTRO_TEXT, font, 0.05f);</span>
<span class="nc" id="L64">        this.game = game;</span>

<span class="nc" id="L66">        stage = new Stage(new FitViewport(Gdx.graphics.getWidth(), Gdx.graphics.getHeight()));</span>

<span class="nc" id="L68">        Skin skin = new Skin(Gdx.files.internal(&quot;images/ui/buttons/glass.json&quot;));</span>
<span class="nc" id="L69">        TextButton BackButton = new TextButton(&quot;Back&quot;, skin); // Universal Skip button</span>
<span class="nc" id="L70">        BackButton.addListener(new ClickListener() {</span>
            @Override
            public void clicked(com.badlogic.gdx.scenes.scene2d.InputEvent event, float x, float y) {
<span class="nc" id="L73">                game.setScreen(GdxGame.ScreenType.MAIN_MENU);</span>


<span class="nc" id="L76">            }</span>
        });
<span class="nc" id="L78">        Table buttonTable = new Table();</span>
<span class="nc" id="L79">        buttonTable.add(BackButton).padRight(10);</span>
<span class="nc" id="L80">        Table table1 = new Table();</span>
<span class="nc" id="L81">        table1.setFillParent(true);</span>
<span class="nc" id="L82">        table1.top().right(); // Align to the top-right corner</span>
<span class="nc" id="L83">        table1.pad(20); // Add padding to the top-right corner</span>
<span class="nc" id="L84">        table1.add(buttonTable).row(); // Add button table and move to the next row</span>
<span class="nc" id="L85">        stage.addActor(table1);</span>

<span class="nc" id="L87">        ServiceLocator.registerResourceService(new ResourceService());</span>
<span class="nc" id="L88">        ServiceLocator.getResourceService().loadMusic(bgm);</span>
<span class="nc" id="L89">        ServiceLocator.getResourceService().loadAll();</span>
<span class="nc" id="L90">        music = ServiceLocator.getResourceService().getAsset(bgm[0], Music.class);</span>

<span class="nc" id="L92">    }</span>

    @Override
    public void show() {
<span class="nc" id="L96">        batch = new SpriteBatch();</span>
<span class="nc" id="L97">        background = new Sprite(new Texture(BG_PATH));</span>
<span class="nc" id="L98">        ServiceLocator.registerGameEndService(new GameEndService());</span>
<span class="nc" id="L99">        Gdx.input.setInputProcessor(stage);</span>

<span class="nc" id="L101">        music.setVolume(0.4f);</span>
<span class="nc" id="L102">        music.setLooping(true);</span>
<span class="nc" id="L103">        music.play();</span>
<span class="nc" id="L104">    }</span>

    /**
     * Spawns the planets on the screen by doing contionous calls to spawnPlanet().
     * The rotation speed of a planet is determined by the frame variable, this
     * function can be modified.
     */
    private void spawnPlanets() {
        // Spawn desert planet
<span class="nc" id="L113">        spawnPlanet(150, 150, Planets.DESERT[0], Planets.DESERT[1], &quot;Desert&quot;, 1, (int) (timeCounter * 60) % 60 + 1);</span>
        // Spawn ice planet
<span class="nc" id="L115">        spawnPlanet(150, 150, Planets.ICE[0], Planets.ICE[1],&quot;Barren_or_Moon&quot;, 2, (int) (timeCounter * 35) % 60 + 1);</span>
        // Spawn lava planet
<span class="nc" id="L117">        spawnPlanet(200, 200, Planets.LAVA[0], Planets.LAVA[1],&quot;Lava&quot;, 1, (int) (timeCounter * 15) % 60 + 1);</span>

<span class="nc" id="L119">        spawnPlanetBorders();</span>
<span class="nc" id="L120">    }</span>

    /**
     * Spawns a planet on the screen.
     * @param width The width of the planet
     * @param height The height of the planet
     * @param posx The x position of the planet
     * @param posy The y position of the planet
     * @param planetName The name of the planet
     * @param version The different type of planet
     * @param frame The frame of the planet
     */
    private void spawnPlanet(int width, int height, int posx, int posy, String planetName, int version, int frame) {
<span class="nc" id="L133">        Texture planet = new Texture(String.format(&quot;planets/%s/%d/%d.png&quot;, planetName, version, frame));</span>
<span class="nc" id="L134">        Sprite planetSprite = new Sprite(planet);</span>
<span class="nc" id="L135">        planetSprite.setSize(width, height);</span>
<span class="nc" id="L136">        batch.draw(planetSprite, posx, posy, width, height);</span>
<span class="nc" id="L137">    }</span>

    /**
     * Spawns the borders of the planets. If a planet is clicked it will load the level
     * based on the planet. If a planet is hovered over it will display a border around
     * the planet.
     */
    private void spawnPlanetBorders() {
<span class="nc" id="L145">        Vector3 mousePos = new Vector3(Gdx.input.getX(), Gdx.input.getY(), 0);</span>
        // Iterates through the planets checking for the bounding box
<span class="nc bnc" id="L147" title="All 2 branches missed.">        for (int[] planet : Planets.PLANETS) {</span>
<span class="nc" id="L148">            Rectangle planetRect = new Rectangle(planet[0], planet[1], planet[2], planet[3]);</span>
<span class="nc bnc" id="L149" title="All 2 branches missed.">            if (planetRect.contains(mousePos.x, (float) Gdx.graphics.getHeight() - mousePos.y)) {</span>
                // If the mouse is over a planet, draw the planet border
<span class="nc" id="L151">                Sprite planetBorder = new Sprite(new Texture(&quot;planets/planetBorder.png&quot;));</span>
<span class="nc" id="L152">                batch.draw(planetBorder, planet[0] - 2.0f, planet[1] - 2.0f, planet[2] + 3.0f, planet[3] + 3.0f);</span>
<span class="nc bnc" id="L153" title="All 2 branches missed.">                if (Gdx.input.justTouched()) {</span>
                    // If the planet is clicked, load the corresponding level
<span class="nc" id="L155">                    dispose();</span>
<span class="nc" id="L156">                    logger.info(&quot;Loading level {}&quot;, planet[4]);</span>
<span class="nc" id="L157">                    GameLevelData.setSelectedLevel(planet[4]);</span>
<span class="nc" id="L158">                        game.setScreen(new TurretSelectionScreen(game));</span>
                    }
                }
            }
<span class="nc" id="L162">        }</span>



    // TODO: Make it display information about the planet
    @Override
    public void render(float delta) {
<span class="nc" id="L169">        Gdx.gl.glClearColor(0, 0, 0, 1);</span>
<span class="nc" id="L170">        Gdx.gl.glClear(GL20.GL_COLOR_BUFFER_BIT);</span>
<span class="nc" id="L171">        timeCounter += delta;</span>

        // Gets position of cursor
<span class="nc" id="L174">        batch.begin();</span>
        // Draws the background
<span class="nc" id="L176">        batch.draw(background, 0, 0, Gdx.graphics.getWidth(), Gdx.graphics.getHeight());</span>
        // Draws the planets on top of the background.
<span class="nc" id="L178">        spawnPlanets();</span>
<span class="nc" id="L179">        text.update();</span>
<span class="nc" id="L180">        text.draw(batch, 100, 700); // Adjust the position</span>
<span class="nc" id="L181">        batch.end();</span>
<span class="nc" id="L182">        stage.act(Math.min(Gdx.graphics.getDeltaTime(), 1 / 30f));</span>
<span class="nc" id="L183">        stage.draw();</span>
<span class="nc" id="L184">    }</span>
    public void resize(int width, int height) {
<span class="nc" id="L186">        stage.getViewport().update(width, height, true);</span>
<span class="nc" id="L187">    }</span>

    @Override
    public void dispose() {
<span class="nc" id="L191">        stage.dispose();</span>
<span class="nc" id="L192">        batch.dispose();</span>
<span class="nc" id="L193">        music.dispose();</span>
<span class="nc" id="L194">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>